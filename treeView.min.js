/**
 * in the name of allah
 * Created by ParhamZare on 2/22/2016.
 * email:parhamzare1@gmail.com
 */
angular.module("treeView",[]).directive("treeView",function(e,t){return{template:'<div ><script type="text/ng-template" id="field_renderer.html1"> <label  ng-class="{\'hasChild\':field.children.length>0}" for=""> <span ng-click="addExpended(field.id)" ng-show="field.children.length>0">> </span> <input type="checkbox" ng-model="selectedItems[field.id]">{{field.name}} </label> <ul ng-if="field.children" ng-init="parentId=field.id"> <li id="{{parentId}}" ng-show="isExpend({{parentId}})" style="list-style-type: circle" ng-repeat="field in field.children" ng-include="\'field_renderer.html1\'"> </li> </ul> </script> <ul style="list-style-type: circle"> <li  style="list-style-type: circle"ng-repeat="field in lstItems"ng-include="\'field_renderer.html1\'"> </li> </ul> </div>',restrict:"AE",replace:!0,scope:{data:"@",fetchUrl:"@",fetchType:"@",mySelection:"=",ngModel:"="},link:function(n,l,d){if(n.lstItems=[],void 0!=n.data)n.lstItems=JSON.parse(n.data),n.loaded=1;else switch(console.log(n.fetchType),n.fetchType){case"get":var i=e.getData(n.fetchUrl);i.then(function(e){n.lstItems=e,n.loaded=1});break;case"post":var i=t.postData(n.fetchUrl);i.then(function(e){n.lstItems=e,n.loaded=1})}},controller:function(e){function t(n,l){n.forEach(function(n){parseInt(n.id)==parseInt(l)?e.seledctedCategories2.push(n):n.children.length>0&&t(n.children,parseInt(l))})}e.selectedItems={},e.seledctedCategories2=[],e.loaded=0,e.$watch("loaded",function(t){1==e.loaded&&e.findAndSet()}),e.$watchCollection("selectedItems",function(t){e.findAndSet()}),e.findAndSet=function(){e.seledctedCategories2=[];for(var n in e.selectedItems)e.selectedItems[n]&&t(e.lstItems,n);e.ngModel=e.seledctedCategories2},"object"==typeof e.mySelection&&e.mySelection.forEach(function(t){e.selectedItems[t.id]=!0}),e.lstExpended=[],e.isExpend=function(t){var n=!1;return e.lstExpended.forEach(function(e){parseInt(e)==t&&(n=!0)}),n},e.addExpended=function(t){if(0==e.lstExpended.length)e.lstExpended.push(parseInt(t));else{var n=0;e.lstExpended.forEach(function(l,d){parseInt(l)==parseInt(t)&&(e.lstExpended.splice(d,1),n++)}),0==n&&e.lstExpended.push(parseInt(t))}}}}}),myApp.factory("myService",function(e){var t=function(t){return e({method:"GET",url:t}).then(function(e){return e.data})};return{getData:t}}),myApp.factory("myServicePost",function(e){var t=function(t,n){return e({method:"POST",url:t,data:n}).error(function(e){console.log(e)}).then(function(e){return e.data})};return{postData:t}});